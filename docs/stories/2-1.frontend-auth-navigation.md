# Story 2-1: 前端認證與導航系統

## Story Details
- **Story ID**: 2-1
- **Branch**: feature/story-2-1
- **Dependencies**: Stories 1-1, 1-2, 1-3 (需要基礎設施與認證 API)
- **Parallel-safe**: ✅ True
- **Module**: Login pages, protected routes, navigation components

## Status
Draft

## Story
**As a** 專案成員,
**I want** 一個使用者友善的登入介面和安全的導航系統,
**so that** 我能夠安全地存取 PCM 平台並在不同頁面間導航

## Acceptance Criteria
1. 提供響應式登入頁面
2. 實作受保護路由中介軟體
3. 建立主導航元件
4. 整合 NextAuth.js 進行前端認證
5. 登入成功後導向專案選擇頁
6. 失敗時顯示適當的錯誤訊息
7. 提供登出功能

## Tasks / Subtasks
- [ ] 建立登入頁面結構 (AC: 1)
  - [ ] 建立 (auth)/login/page.tsx
  - [ ] 實作響應式佈局設計
  - [ ] 整合 shadcn/ui 元件
  - [ ] 套用 PCM 品牌風格
- [ ] 實作登入表單 (AC: 1, 6)
  - [ ] 建立帳號密碼輸入欄位
  - [ ] 實作表單驗證邏輯
  - [ ] 建立送出按鈕和載入狀態
  - [ ] 實作錯誤訊息顯示
- [ ] 整合認證功能 (AC: 4, 5)
  - [ ] 整合 NextAuth.js signIn 功能
  - [ ] 實作登入狀態管理
  - [ ] 處理認證成功/失敗流程
  - [ ] 實作頁面重導向邏輯
- [ ] 實作受保護路由 (AC: 2)
  - [ ] 建立 middleware.ts 檔案
  - [ ] 實作會話檢查邏輯
  - [ ] 配置路由群組保護
  - [ ] 處理未授權存取重導向
- [ ] 建立導航系統 (AC: 3, 7)
  - [ ] 建立主導航元件
  - [ ] 實作使用者資訊顯示
  - [ ] 建立登出按鈕
  - [ ] 實作導航狀態管理

## Dev Notes

### Previous Story Insights
依賴 Story 1-3 的認證 API。與後端 API 開發並行，通過 API 契約進行整合。

### UI 設計要求
[Source: architecture/architecture-frontend.md#元件範本]
遵循 React + TypeScript + shadcn/ui 的標準範本。

### 品牌風格
[Source: docs/prd/prd-ui-design.md#品牌形象]
- 主色調：專業、沉穩的綠色
- 整體風格與 shadcn/ui 元件庫的簡潔美學保持一致
- 採用乾淨、簡潔的卡片式佈局

### 路由結構
[Source: architecture/architecture-frontend.md#路由組織結構]
```
apps/web/src/app/
├── (auth)/             # 放置「不需」登入即可存取的頁面
│   └── login/
│       └── page.tsx
├── (main)/             # 放置「需要」登入才能存取的主應用程式頁面
│   ├── layout.tsx
│   ├── projects/
│   │   └── page.tsx
```

### NextAuth.js 前端整合
```typescript
import { signIn } from 'next-auth/react';

const handleSubmit = async (credentials) => {
  const result = await signIn('credentials', {
    username: credentials.username,
    password: credentials.password,
    redirect: false
  });
  
  if (result?.error) {
    // 處理錯誤
  } else {
    // 重導向到專案選擇頁
    router.push('/projects');
  }
};
```

### 檔案位置
- 登入頁面：`apps/web/src/app/(auth)/login/page.tsx`
- 中介軟體：`apps/web/src/middleware.ts`
- 導航元件：`apps/web/src/components/common/Navigation.tsx`
- 登入表單：`apps/web/src/components/features/LoginForm.tsx`

### Parallel Development Considerations
- 此故事專注於前端認證介面，與後端 API 故事並行開發
- 使用 mock 或 API 契約進行前端開發
- 不依賴其他前端功能模組

### Testing
[Source: architecture/architecture-standards.md#測試策略]
- **測試檔案位置**: apps/web/__tests__/components/ (元件測試)
- **測試標準**: React Testing Library 元件測試
- **測試框架**: Jest + React Testing Library
- **此故事的特定測試要求**:
  - 測試登入表單元件
  - 測試受保護路由中介軟體
  - 測試導航元件
  - 測試認證流程 (mock)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | 初始故事建立 - 並行開發第二組 | Bob (Scrum Master) |

## Dev Agent Record
_This section will be populated by the development agent during implementation_

## QA Results
_Results from QA Agent review will be populated here after implementation_