# Story 1.2: 資料庫連接與種子資料

## Status
Draft

## Story
**As a** 開發者,
**I want** 建立 Oracle 資料庫連接並建立測試用的種子資料腳本,
**so that** 後續功能在沒有正式資料時也能被開發與測試

## Acceptance Criteria
1. 建立 Oracle 資料庫連接配置
2. 「種子資料」腳本被建立
3. 執行腳本後，使用者、專案等資料表會被填入樣本資料
4. 樣本資料足以讓後續的登入與專案選擇功能正常運作

## Tasks / Subtasks
- [ ] 設定 Oracle 資料庫連接 (AC: 1)
  - [ ] 安裝 Oracle 客戶端 driver (oracledb)
  - [ ] 建立資料庫連接配置檔案 lib/db.ts
  - [ ] 實作連接池管理
  - [ ] 建立健康檢查端點 /api/health
- [ ] 建立資料庫 Schema (AC: 2)
  - [ ] 建立所有必要的資料表 CREATE 語句
  - [ ] 建立索引和約束
  - [ ] 建立序列和觸發器
- [ ] 建立種子資料腳本 (AC: 2, 3)
  - [ ] 建立 scripts/seed-data.sql 腳本
  - [ ] 建立 scripts/seed-runner.js Node.js 腳本
  - [ ] 插入測試用使用者資料
  - [ ] 插入測試專案資料
  - [ ] 插入角色和權限資料
- [ ] 驗證種子資料品質 (AC: 4)
  - [ ] 驗證登入用的測試帳號可用
  - [ ] 驗證專案資料完整性
  - [ ] 建立資料驗證腳本

## Dev Notes

### Previous Story Insights
依賴 Story 1.1 的專案結構和 Docker 環境。

### 資料庫連接架構
[Source: architecture/architecture-backend.md#資料庫架構]
- 採用倉儲模式 (Repository Pattern)
- 所有 SQL 查詢封裝在 Repository 檔案中
- 業務邏輯層 (Service) 只呼叫 Repository

### 資料表結構
[Source: architecture/architecture-data-models.md#資料庫結構]
需要建立的核心資料表：
- USERS (使用者表)
- PROJECTS (專案表)
- ROLES (角色表)
- USER_ROLES (使用者角色關聯表)
- SUBCONTRACTORS (協力廠商表)
- PERSONNEL (廠商人員表)

### 環境變數要求
[Source: architecture/architecture-project-structure.md#環境變數]
```env
DATABASE_URL=oracle://username:password@localhost:1521/xe
DATABASE_SCHEMA=PCM
```

### 檔案位置
[Source: architecture/architecture-project-structure.md#統一專案結構]
- 資料庫連接：`apps/web/src/lib/db.ts`
- 種子腳本：`scripts/seed-data.sql`
- 腳本執行器：`scripts/seed-runner.js`

### Oracle 資料庫配置
需要使用 Oracle 客戶端程式庫連接，配置連接池管理來優化效能。

### 種子資料內容
至少需要包含：
- 3-5 個測試使用者（包含不同角色）
- 2-3 個測試專案
- 基本角色：PM (專案經理), QC (品管人員), Supervisor (工地主任)
- 使用者與專案的權限關聯

### Testing
[Source: architecture/architecture-standards.md#測試策略]
- **測試檔案位置**: apps/web/__tests__/integration/ (資料庫連接測試)
- **測試標準**: 整合測試驗證資料庫連接和種子資料
- **測試框架**: Jest (整合測試)
- **此故事的特定測試要求**: 
  - 測試資料庫連接可用性
  - 測試種子資料腳本執行成功
  - 驗證種子資料完整性和一致性

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | 初始故事建立 | Bob (Scrum Master) |

## Dev Agent Record
_This section will be populated by the development agent during implementation_

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_Results from QA Agent review will be populated here after implementation_