# Story 4: 儀表板整合與角色視圖

## Story Details
- **Story ID**: 4
- **Branch**: feature/story-4
- **Dependencies**: Stories 1-1 到 3-3 (需要所有資料來源完成)
- **Parallel-safe**: ❌ False (整合所有前期工作)
- **Module**: Main dashboard, role-based content, data aggregation

## Status
Draft

## Story
**As a** 專案經理或品管人員,
**I want** 在儀表板上看到與我角色相關的數據,
**so that** 我能快速掌握專案狀況並做出決策

## Acceptance Criteria
1. 建立主儀表板頁面
2. 系統根據角色顯示不同內容
3. PM 角色能看到「時程摘要」與「每日工時」
4. QC 角色能看到「品質稽核文件摘要」
5. 儀表板顯示最新公告
6. 提供即時數據更新功能
7. 支援儀表板客製化配置

## Tasks / Subtasks
- [ ] 建立儀表板數據 API (AC: 1, 6)
  - [ ] 建立 dashboardService.ts
  - [ ] 建立 /api/dashboard 端點
  - [ ] 實作數據聚合邏輯
  - [ ] 實作即時數據更新 API
- [ ] 實作角色化內容 (AC: 2, 3, 4)
  - [ ] 建立角色內容配置邏輯
  - [ ] 實作 PM 儀表板數據整合
  - [ ] 實作 QC 儀表板數據整合
  - [ ] 建立其他角色視圖支援
- [ ] 建立儀表板前端架構 (AC: 1)
  - [ ] 建立主儀表板佈局元件
  - [ ] 實作響應式網格系統
  - [ ] 建立儀表板卡片元件
  - [ ] 實作載入和錯誤狀態
- [ ] 實作 PM 角色儀表板 (AC: 3)
  - [ ] 建立時程摘要元件
  - [ ] 建立每日工時統計元件
  - [ ] 整合 WBS 進度數據
  - [ ] 建立專案狀態概覽
- [ ] 實作 QC 角色儀表板 (AC: 4)
  - [ ] 建立品質稽核文件摘要
  - [ ] 建立報告審核狀態顯示
  - [ ] 整合檢查項目追蹤
  - [ ] 建立品質指標圖表
- [ ] 整合公告功能 (AC: 5)
  - [ ] 建立最新公告顯示元件
  - [ ] 實作公告優先級排序
  - [ ] 建立公告詳細檢視
  - [ ] 實作公告已讀狀態
- [ ] 實作儀表板客製化 (AC: 7)
  - [ ] 建立儀表板配置 API
  - [ ] 實作拖拉調整佈局
  - [ ] 建立個人化設定
  - [ ] 實作儀表板範本功能

## Dev Notes

### Previous Story Insights
此故事整合所有前期故事的功能和資料，是系統的核心展示介面。需要所有並行故事完成後才能開始。

### 儀表板數據整合
從以下來源整合數據：
- Story 1-2: 專案和使用者基礎資料
- Story 2-2: 角色權限數據
- Story 2-3: 人員管理數據
- Story 3-1: WBS 進度數據
- Story 3-2: 出勤和值班數據
- Story 3-3: 報告和文件數據

### 角色化儀表板設計
[Source: docs/prd/prd-epic3-core-features.md#使用者故事3.4]
不同角色看到不同的儀表板內容：

**PM (專案經理) 儀表板**:
- 時程摘要圖表
- 每日工時統計
- WBS 完成進度
- 專案里程碑狀態
- 人員出勤概覽
- 問題與風險提醒

**QC (品管人員) 儀表板**:
- 品質稽核文件摘要
- 檢查項目完成狀態
- 品質問題追蹤
- 報告審核待辦
- 品質指標趨勢

### 儀表板API設計
```typescript
interface DashboardData {
  role: UserRole;
  widgets: DashboardWidget[];
  announcements: Announcement[];
  lastUpdated: Date;
}

interface DashboardWidget {
  id: string;
  type: 'chart' | 'table' | 'metric' | 'list';
  title: string;
  data: any;
  config: WidgetConfig;
}
```

### 即時數據更新
使用 WebSocket 或 Server-Sent Events 實作：
- 數據變更通知
- 自動重新整理
- 即時狀態更新
- 離線狀態處理

### 響應式儀表板設計
[Source: docs/prd/prd-ui-design.md#跨平台響應式設計]
- 桌面版：多欄位網格佈局
- 平板版：兩欄佈局
- 手機版：單欄垂直佈局
- 支援橫向/縱向切換

### 數據視覺化元件
使用 Chart.js 或 D3.js 實作：
- 進度圓餅圖
- 時程甘特圖
- 工時趨勢線圖
- 狀態分佈圖
- KPI 指標卡片

### 儀表板客製化功能
- 拖拉調整卡片位置
- 顯示/隱藏特定卡片
- 調整卡片大小
- 儲存個人化配置
- 重置為預設佈局

### 檔案位置
- 儀表板服務：`apps/web/src/services/dashboardService.ts`
- 儀表板 API：`apps/web/src/app/api/dashboard/`
- 儀表板頁面：`apps/web/src/app/(main)/[projectId]/dashboard/`
- 儀表板元件：`apps/web/src/components/features/dashboard/`
- 圖表元件：`apps/web/src/components/common/charts/`

### Sequential Development Considerations
- 必須等待所有並行故事完成
- 整合測試需要完整的功能流程
- 效能優化需要真實數據測試
- 使用者體驗需要完整功能驗證

### Testing
[Source: architecture/architecture-standards.md#測試策略]
- **測試檔案位置**: 
  - apps/web/tests/integration/ (API 整合測試)
  - apps/web/__tests__/components/ (元件測試)
  - apps/web/tests/e2e/ (完整流程 E2E 測試)
- **測試標準**: 完整的整合測試和 E2E 測試
- **測試框架**: Jest + React Testing Library + Playwright
- **此故事的特定測試要求**:
  - 測試儀表板數據整合 API
  - 測試角色化內容顯示
  - 測試即時數據更新
  - 測試響應式佈局
  - E2E 測試完整使用者流程

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | 初始故事建立 - 序列開發 | Bob (Scrum Master) |

## Dev Agent Record
_This section will be populated by the development agent during implementation_

## QA Results
_Results from QA Agent review will be populated here after implementation_