# Story 2-3: 人員通訊錄管理系統

## Story Details
- **Story ID**: 2-3
- **Branch**: feature/story-2-3
- **Dependencies**: Stories 1-1, 1-2, 1-3 (需要基礎設施與認證系統)
- **Parallel-safe**: ✅ True
- **Module**: Personnel CRUD, subcontractor management, directory features

## Status
Draft

## Story
**As a** 管理者,
**I want** 一個使用者介面來管理協力廠商及其人員資料,
**so that** 我能擁有一個中央通訊錄來管理所有專案相關人員

## Acceptance Criteria
1. 提供人員管理頁面
2. 可新增協力廠商
3. 可在協力廠商下新增人員
4. 資料以可搜尋的列表呈現
5. 提供編輯與刪除功能
6. 支援批量匯入人員資料
7. 提供人員聯絡資訊查詢

## Tasks / Subtasks
- [ ] 建立協力廠商管理 API (AC: 2)
  - [ ] 建立 subcontractorRepository.ts
  - [ ] 建立 /api/subcontractors 端點
  - [ ] 實作 CRUD 操作 (Create, Read, Update, Delete)
  - [ ] 實作搜尋和篩選功能
- [ ] 建立人員管理 API (AC: 3, 5)
  - [ ] 建立 personnelRepository.ts  
  - [ ] 建立 /api/personnel 端點
  - [ ] 實作人員 CRUD 操作
  - [ ] 實作人員與廠商關聯邏輯
- [ ] 建立協力廠商管理前端 (AC: 1, 2, 4, 5)
  - [ ] 建立廠商列表元件
  - [ ] 建立新增廠商表單
  - [ ] 建立編輯廠商表單
  - [ ] 實作廠商搜尋功能
- [ ] 建立人員管理前端 (AC: 3, 4, 5, 7)
  - [ ] 建立人員列表元件
  - [ ] 建立新增人員表單
  - [ ] 建立編輯人員表單
  - [ ] 實作人員搜尋和篩選
  - [ ] 建立人員詳細資訊頁面
- [ ] 實作批量匯入功能 (AC: 6)
  - [ ] 建立 CSV/Excel 匯入介面
  - [ ] 實作檔案解析邏輯
  - [ ] 建立資料驗證和錯誤處理
  - [ ] 提供匯入結果報告

## Dev Notes

### Previous Story Insights
依賴 Story 1-2 的資料庫 SUBCONTRACTORS 和 PERSONNEL 表。與其他管理功能獨立，可並行開發。

### 資料模型
[Source: architecture/architecture-data-models.md#資料庫結構]
- **SUBCONTRACTORS**: 協力廠商基本資訊
- **PERSONNEL**: 廠商人員詳細資訊，透過 subcontractor_id 關聯

### 協力廠商資料結構
```sql
CREATE TABLE SUBCONTRACTORS (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name NVARCHAR2(255) NOT NULL,
    contact_person NVARCHAR2(255),
    phone VARCHAR2(50),
    email VARCHAR2(255),
    address NVARCHAR2(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 人員資料結構
```sql
CREATE TABLE PERSONNEL (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    subcontractor_id NUMBER NOT NULL,
    name NVARCHAR2(255) NOT NULL,
    position NVARCHAR2(255),
    phone VARCHAR2(50),
    email VARCHAR2(255),
    employee_id VARCHAR2(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (subcontractor_id) REFERENCES SUBCONTRACTORS(id)
);
```

### API 端點設計
[Source: architecture/architecture-api-spec.md#協力廠商與人員API]
- `GET /api/subcontractors` - 取得協力廠商列表
- `POST /api/subcontractors` - 新增協力廠商
- `PUT /api/subcontractors/{id}` - 更新協力廠商
- `DELETE /api/subcontractors/{id}` - 刪除協力廠商
- `GET /api/personnel` - 取得人員列表
- `POST /api/personnel` - 新增人員
- `PUT /api/personnel/{id}` - 更新人員
- `DELETE /api/personnel/{id}` - 刪除人員

### 前端元件架構
[Source: architecture/architecture-frontend.md#元件組織結構]
```
apps/web/src/components/features/
├── subcontractor-management/
│   ├── SubcontractorList.tsx
│   ├── SubcontractorForm.tsx
│   └── SubcontractorCard.tsx
└── personnel-management/
    ├── PersonnelList.tsx
    ├── PersonnelForm.tsx
    ├── PersonnelCard.tsx
    └── PersonnelImport.tsx
```

### 搜尋和篩選功能
- 按廠商名稱搜尋
- 按人員姓名搜尋
- 按職位篩選
- 按聯絡方式篩選
- 支援模糊搜尋和精確搜尋

### 批量匯入設計
- 支援 CSV 和 Excel 格式
- 提供範本檔案下載
- 實作資料驗證邏輯
- 顯示匯入進度和結果

### 檔案位置
- 廠商 Repository：`apps/web/src/repositories/subcontractorRepository.ts`
- 人員 Repository：`apps/web/src/repositories/personnelRepository.ts`
- 廠商 API：`apps/web/src/app/api/subcontractors/`
- 人員 API：`apps/web/src/app/api/personnel/`
- 管理頁面：`apps/web/src/app/(main)/personnel/`

### Parallel Development Considerations
- 此故事專注於人員資料管理，與其他業務邏輯模組獨立
- 為後續值班表和報告功能提供人員資料基礎
- 可與角色權限和前端認證並行開發

### Testing
[Source: architecture/architecture-standards.md#測試策略]
- **測試檔案位置**: 
  - apps/web/tests/integration/ (API 測試)
  - apps/web/__tests__/components/ (元件測試)
- **測試標準**: API 整合測試 + React 元件測試
- **測試框架**: Jest + React Testing Library
- **此故事的特定測試要求**:
  - 測試人員管理 API 端點
  - 測試搜尋和篩選功能
  - 測試批量匯入功能
  - 測試前端 CRUD 操作

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | 初始故事建立 - 並行開發第二組 | Bob (Scrum Master) |

## Dev Agent Record
_This section will be populated by the development agent during implementation_

## QA Results
_Results from QA Agent review will be populated here after implementation_