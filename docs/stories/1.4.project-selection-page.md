# Story 1.4: 專案選擇頁面

## Status
Draft

## Story
**As a** 已登入的使用者,
**I want** 看到我有權限存取的專案列表,
**so that** 我可以選擇要進入的專案開始工作

## Acceptance Criteria
1. 登入後自動導向專案選擇頁
2. 以卡片形式顯示專案列表
3. 根據使用者權限顯示專案
4. 卡片上顯示專案關鍵資訊 (名稱、狀態、進度等)
5. 點擊卡片後能導向主儀表板
6. 提供登出功能

## Tasks / Subtasks
- [ ] 建立專案選擇頁面 (AC: 1, 6)
  - [ ] 建立 (main)/projects/page.tsx
  - [ ] 實作受保護路由 middleware
  - [ ] 整合登出功能
  - [ ] 建立頁面佈局和導航
- [ ] 實作專案 API 和服務 (AC: 3)
  - [ ] 建立 /api/projects GET 端點
  - [ ] 實作 projectRepository.ts
  - [ ] 建立 projectService.ts
  - [ ] 實作使用者權限檢查邏輯
- [ ] 建立專案卡片元件 (AC: 2, 4)
  - [ ] 建立 ProjectCard.tsx 元件
  - [ ] 實作響應式卡片佈局
  - [ ] 顯示專案關鍵資訊
  - [ ] 加入進度條和狀態標籤
- [ ] 實作專案選擇功能 (AC: 5)
  - [ ] 處理卡片點擊事件
  - [ ] 實作專案導向邏輯
  - [ ] 建立專案 Context 狀態管理
  - [ ] 導向到主儀表板頁面

## Dev Notes

### Previous Story Insights
依賴 Story 1.3a (認證後端) 和 1.3b (登入前端) 完成。需要使用者已通過身份驗證。

### 專案資料模型
[Source: architecture/architecture-data-models.md#資料庫結構]
PROJECTS 表結構：
- id: NUMBER (主鍵)
- name: NVARCHAR2(255) (專案名稱)
- code: VARCHAR2(50) (專案代碼)
- status: NVARCHAR2(50) (專案狀態)
- start_date: DATE (開始日期)
- planned_submission_date: DATE (預計完成日期)
- total_duration_days: NUMBER (總工期天數)

### API 規格
[Source: architecture/architecture-api-spec.md#專案API]
- `GET /api/projects` - 取得使用者可存取的專案列表

### 路由架構
[Source: architecture/architecture-frontend.md#路由組織結構]
```
apps/web/src/app/
├── (main)/             # 需要登入才能存取的頁面
│   ├── layout.tsx
│   ├── projects/
│   │   └── page.tsx
```

### 受保護路由實作
[Source: architecture/architecture-frontend.md#受保護路由模式]
使用 middleware.ts 檔案保護 (main) 群組下的所有路由，檢查使用者 Session。

### 元件架構
[Source: architecture/architecture-frontend.md#元件組織結構]
```
apps/web/src/components/
├── features/
│   ├── ProjectCard.tsx      # 專案卡片元件
│   └── ProjectList.tsx      # 專案列表容器
├── common/
│   └── PageHeader.tsx       # 頁面標題元件
```

### 專案卡片設計範例
[Source: architecture/architecture-frontend.md#元件範本]
```typescript
interface ProjectCardProps {
  project: Project;
  onSelect: (projectId: number) => void;
}

const ProjectCard: React.FC<ProjectCardProps> = ({ project, onSelect }) => {
  return (
    <Card className="cursor-pointer hover:shadow-lg transition-shadow">
      <CardHeader>
        <CardTitle>{project.name}</CardTitle>
        <p className="text-sm text-gray-600">{project.code}</p>
      </CardHeader>
      <CardContent>
        <p>狀態：{project.status}</p>
        <Progress value={calculateProgress(project)} className="w-full" />
      </CardContent>
    </Card>
  );
};
```

### Repository 模式實作
[Source: architecture/architecture-backend.md#資料存取層]
```typescript
export const projectRepository = {
  async findByUserId(userId: number): Promise<Project[]> {
    const result = await db.query(
      'SELECT * FROM PROJECTS p JOIN USER_PROJECTS up ON p.id = up.project_id WHERE up.user_id = :userId',
      { userId }
    );
    return result.rows as Project[];
  }
};
```

### 狀態管理
[Source: architecture/architecture-frontend.md#狀態管理架構]
- 使用 TanStack Query 管理專案資料 (伺服器狀態)
- 使用 Zustand 管理當前選擇的專案 (客戶端狀態)

### 品牌風格應用
[Source: docs/prd/prd-ui-design.md#品牌形象]
- 狀態色系：綠色「進行中」，紅色/橘色「已逾期」，灰色「已完成」
- 卡片式佈局，善用留白
- 專業且易於閱讀的介面

### 權限檢查邏輯
需要實作使用者專案權限檢查：
- 檢查 USER_ROLES 表中的專案權限
- 只顯示使用者有權存取的專案
- 考慮不同角色的存取範圍

### 檔案位置
- 專案選擇頁：`apps/web/src/app/(main)/projects/page.tsx`
- 專案 API：`apps/web/src/app/api/projects/route.ts`
- 專案 Repository：`apps/web/src/repositories/projectRepository.ts`
- 專案服務：`apps/web/src/services/projectService.ts`
- 專案卡片元件：`apps/web/src/components/features/ProjectCard.tsx`

### 導向邏輯
點擊專案卡片後導向：`/(main)/[projectId]/dashboard`

### Testing
[Source: architecture/architecture-standards.md#測試策略]
- **測試檔案位置**: 
  - apps/web/__tests__/components/features/ (元件測試)
  - apps/web/tests/integration/ (API 測試)
- **測試標準**: React Testing Library + Jest
- **測試框架**: Jest + React Testing Library + Playwright (E2E)
- **此故事的特定測試要求**:
  - 測試專案列表 API 端點
  - 測試 ProjectCard 元件渲染
  - 測試專案選擇和導向功能
  - 測試權限檢查邏輯
  - E2E 測試：登入→專案選擇→儀表板流程

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-09 | 1.0 | 初始故事建立 | Bob (Scrum Master) |

## Dev Agent Record
_This section will be populated by the development agent during implementation_

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_Results from QA Agent review will be populated here after implementation_